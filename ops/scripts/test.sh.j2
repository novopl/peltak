#!/bin/bash
set -e

pytest \
    -c ops/tools/pytest.ini \
    --cov-config=ops/tools/coverage.ini \
    --cov=src/peltak \
    --cov-report=term \
    --cov-report=html:{{ conf.build_dir }}/coverage \
    {{ ctx.verbose | count_flag('v') }} \
    {{ '-p no:sugar' if opts.no_sugar else '' }} \
    test/unit

{% set cov_path = proj_path(conf.build_dir, 'coverage/index.html') %}
{{ '<32>HTML report: <34>file://{}' | cprint(cov_path) }}
